V1.1.0 更新日志 (2024-11-26)
=================================

【新功能】Excel导出追加模式 + 智能文件命名

一、核心更新
-----------
1. Excel导出追加模式
   - 工具栏新增"追加模式"勾选框
   - 支持将新数据追加到现有Excel文件
   - 智能合并表头结构（支持不同区域数量）
   - 序号自动连续编号（从现有最大序号+1开始）

2. 新建模式优化
   - Windows风格括号序号：文件名(1).xlsx, 文件名(2).xlsx
   - 自动避免文件覆盖
   - 生成唯一文件名

3. 智能数据合并
   - 自动检测现有和新数据的最大区域数
   - 统一表头结构，数据较少的行自动补齐
   - 完整保留历史数据

二、技术实现
-----------
1. utils.py（更新）
   - FileUtils.get_unique_filename() - 改用括号序号格式
   - ExcelExporter.load_existing_data() - 新增，读取现有Excel
   - ExcelExporter.export_results() - 添加append_mode参数

2. qt_main.py（更新）
   - 导入QCheckBox组件
   - 工具栏添加追加模式勾选框
   - export_excel()方法支持两种导出模式
   - 优化成功提示消息（显示模式类型）

三、使用指南
-----------
1. 追加模式
   - 勾选"追加模式"复选框
   - 选择已存在的Excel文件
   - 新数据将追加到文件末尾
   - 表头自动统一为最大区域数

2. 新建模式（默认）
   - 不勾选"追加模式"
   - 如文件存在，自动生成唯一名称
   - 格式：原文件名(1).xlsx, 原文件名(2).xlsx, ...

四、解决的问题
-----------
✅ 修复不同模型导出Excel时写入失败的问题
✅ 支持分批处理并累积到同一Excel
✅ 避免意外覆盖现有导出文件
✅ 处理不同区域数量的数据合并

五、文件修改
-----------
- 更新：utils.py（3处修改）
- 更新：qt_main.py（3处修改）
- 新增：EXCEL_APPEND_MODE.md（功能说明文档）
- 更新：更新日志.txt（本文件）

六、测试建议
-----------
详见 EXCEL_APPEND_MODE.md 中的完整测试指南


V0.0.5 更新日志 (2025-11-25)
=================================

【新功能】DeepSeek-OCR引擎集成 + 文档完善

一、核心更新
-----------
1. 新增DeepSeek OCR引擎（硅基流动平台）
   - 使用OpenAI兼容接口，easy接入
   - 支持Free OCR模式，输出纯文本
   - 智能文本清理功能，自动移除标记
   - 当前限免测试，适合新技术评测

2. 4引擎无缝切换
   - GUI下拉菜单一键切换4种OCR引擎
   - 引擎状态实时显示（就绪/未就绪）
   - 后台异步初始化，互不影响

3. 安全性增强
   - 移除代码中的硬编码API密钥
   - 支持环境变量配置（推荐）
   - 添加.env.example配置示例
   - 敏感文件已加入.gitignore

4. 文档全面更新
   - README.md完全重写（基于v0.0.4）
   - 添加4种OCR引擎对比表格
   - 详细的快速开始指南
   - 完善的常见问题解答
   - 环境变量配置说明

二、技术实现
-----------
1. ocr_engine_deepseek.py（新增）
   - 378行完整引擎实现
   - _clean_ocr_result()智能文本清理
   - 支持PIL Image → Base64转换
   - 统一接口设计（与其他引擎一致）

2. ocr_engine_manager.py（更新）
   - 新增DEEPSEEK引擎类型
   - 扩展引擎信息表
   - 优化后台初始化顺序
   - 智能可用性检测

3. config.py（更新）
   - 新增DeepSeek配置项
   - 优化API密钥读取（环境变量优先）
   - Free OCR模式提示词

4. requirements.txt（更新）
   - 新增openai>=1.0.0依赖

三、文件修改
-----------
- 新增：ocr_engine_deepseek.py
- 新增：.env.example
- 更新：README.md（完全重写）
- 更新：ocr_engine_manager.py
- 更新：config.py
- 更新：requirements.txt
- 更新：更新日志.txt（本文件）

四、使用指南
-----------
1. 获取DeepSeek API密钥
   - 访问：https://cloud.siliconflow.cn/
   - 注册并创建API密钥

2. 配置方式（二选一）
   方式1（推荐）：
     export DEEPSEEK_API_KEY='sk-xxxxxx'
   
   方式2：
     修改config.py中的DEEPSEEK_API_KEY

3. 安装依赖
   pip install openai

4. 运行测试
   python ocr_engine_deepseek.py

五、已知优化
-----------
- DeepSeek OCR提示词优化为Free OCR模式
- 智能清理<|ref|>和<|det|>标记
- 纯文本输出，兼容性更好

六、引擎状态
-----------
✅ PaddleOCR 3.x - 极高精度，本地运行
✅ RapidOCR - 快速轻量，本地运行
✅ 阿里云OCR - 高精度在线服务
✅ DeepSeek OCR - 限免测试，在线服务


V0.0.4 更新日志 (2025-11-22)
=================================

【性能优化】OCR引擎初始化策略重构

一、核心优化
-----------
1. 异步初始化策略
   - 优先初始化：Aliyun OCR（默认引擎）优先初始化，确保UI立即就绪
   - 后台静默初始化：PaddleOCR和RapidOCR在后台线程静默加载，不阻塞主界面
   - 效果：程序启动后立即可用，无需等待所有引擎加载完成

2. 用户体验提升
   - 启动速度显著加快
   - 引擎状态实时反馈：状态栏显示当前引擎就绪状态，后台加载过程透明化

二、文件修改
-----------
- ocr_engine_manager.py: 分离主初始化与后台初始化逻辑
- qt_main.py: 实现OCRInitWorker的双阶段信号机制（primary_init_finished）

V0.0.3 更新日志 (2025-11-21)
=================================

【重大修复】完整适配PaddleOCR 3.x + 新增RapidOCR引擎

一、核心修复
-----------
1. PaddleOCR引擎 - 完整适配3.x版本
   - 问题：PaddleOCR 3.3.2 API与2.x完全不同，导致初始化和识别失败
   - 修复：实现智能版本检测和参数降级策略
     * 初始化参数：支持3.x和2.x双版本自动适配
     * 识别API：3.x使用predict()，2.x使用ocr()
     * 结果解析：新增_parse_result_v3()处理3.x字典格式
   - 测试：✓ 初始化成功 | ✓ 识别准确 | ✓ 置信度0.998+

2. RapidOCR引擎 - 完整实现
   - 问题：完全缺少ocr_engine_rapid.py实现文件
   - 修复：创建362行完整引擎实现
     * 基于rapidocr-onnxruntime库
     * 轻量级、快速启动、无需GPU
     * 统一接口设计（与其他引擎一致）
   - 特性：支持全图识别、区域识别、批量处理

二、技术亮点
-----------
1. 智能版本适配
   - 4级兼容性检测：3.x → 2.x完整 → 2.x基础 → 最小参数
   - 自动降级策略：确保在各种环境下都能正常工作
   
2. 统一API接口
   - 三个引擎（Alibaba/PaddleOCR/RapidOCR）提供一致的调用接口
   - 无缝切换，用户体验无差异

三、文件修改
-----------
- ocr_engine_paddle.py: 重构版本适配逻辑，新增3.x支持
- ocr_engine_rapid.py: 新增文件（362行）
- .gitignore: 解除ocr_engine_rapid.py的忽略规则

四、当前引擎状态
-------------
✅ Alibaba OCR - 正常工作
✅ PaddleOCR 3.x - 完整适配
✅ RapidOCR - 新增实现


V0.02 更新日志 (2025-01-21)
=================================

【重大优化】采用按需导入策略，大幅提升性能

一、性能提升
-----------
1. 打包体积：从 800MB-1.5GB 降至 200-500MB（减少 60-75%）
2. 启动速度：从 5-10秒 降至 1-2秒（提升 80%）
3. 初始内存：从 500-800MB 降至 150-250MB（降低 70%）

二、优化内容
-----------
1. utils.py
   - PyMuPDF (fitz): 改为按需导入，仅处理PDF时加载
   - openpyxl: 改为按需导入，仅导出Excel时加载
   
2. ocr_engine_manager.py
   - numpy: 移除顶层导入，在具体引擎中按需使用
   - 各OCR引擎: 延迟导入，仅在切换引擎时加载
   
3. ocr_engine_aliyun_new.py
   - numpy: 改为按需导入，仅处理numpy数组时加载
   
4. qt_main.py
   - OCREngineManager: 在后台线程中异步导入，不阻塞UI启动
   
5. build_nuitka.py
   - 优化打包配置，采用智能按需包含策略
   - 排除不必要的OCR引擎，减小打包体积

三、使用说明
-----------
- 程序启动更快，UI立即响应
- OCR引擎在后台自动加载（首次加载约1-3秒）
- 首次使用PDF/Excel功能时可能有短暂延迟（正常现象）
- 打包后的可执行文件体积显著减小

四、技术细节
-----------
详见 OPTIMIZATION.md 文档

五、已知问题
-----------
暂无已知bug